"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.updateEntity = void 0;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _helpers = require("../helpers");

const updateEntity = ({
  entity,
  repository,
  schema,
  validatePermission,
  user,
  fields
}) => (0, _helpers.validateSchema)(schema)(entity).pipe((0, _operators.switchMap)(({
  id
}) => repository.getById({
  id,
  fields: fields || ['id', 'createdBy']
})), (0, _operators.map)(_helpers.validateEntityExist), (0, _operators.switchMap)(e => validatePermission ? validatePermission(e) : (0, _rxjs.of)(e)), (0, _operators.map)(() => ({ ...entity,
  lastModifiedBy: user === null || user === void 0 ? void 0 : user.id
})), (0, _operators.switchMap)(repository.update));

exports.updateEntity = updateEntity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy91cGRhdGUtZW50aXR5LnRzIl0sIm5hbWVzIjpbInVwZGF0ZUVudGl0eSIsImVudGl0eSIsInJlcG9zaXRvcnkiLCJzY2hlbWEiLCJ2YWxpZGF0ZVBlcm1pc3Npb24iLCJ1c2VyIiwiZmllbGRzIiwicGlwZSIsImlkIiwiZ2V0QnlJZCIsInZhbGlkYXRlRW50aXR5RXhpc3QiLCJlIiwibGFzdE1vZGlmaWVkQnkiLCJ1cGRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFJQTs7QUFDQTs7QUFDQTs7QUFFTyxNQUFNQSxZQU9TLEdBQUcsQ0FBQztBQUFDQyxFQUFBQSxNQUFEO0FBQVNDLEVBQUFBLFVBQVQ7QUFBcUJDLEVBQUFBLE1BQXJCO0FBQTZCQyxFQUFBQSxrQkFBN0I7QUFBaURDLEVBQUFBLElBQWpEO0FBQXVEQyxFQUFBQTtBQUF2RCxDQUFELEtBQ3ZCLDZCQUE4QkgsTUFBOUIsRUFBc0NGLE1BQXRDLEVBQThDTSxJQUE5QyxDQUNFLDBCQUFVLENBQUM7QUFBQ0MsRUFBQUE7QUFBRCxDQUFELEtBQVVOLFVBQVUsQ0FBQ08sT0FBWCxDQUFtQjtBQUFDRCxFQUFBQSxFQUFEO0FBQUtGLEVBQUFBLE1BQU0sRUFBRUEsTUFBTSxJQUFJLENBQUMsSUFBRCxFQUFPLFdBQVA7QUFBdkIsQ0FBbkIsQ0FBcEIsQ0FERixFQUVFLG9CQUFJSSw0QkFBSixDQUZGLEVBR0UsMEJBQVdDLENBQUQsSUFBUVAsa0JBQWtCLEdBQUdBLGtCQUFrQixDQUFDTyxDQUFELENBQXJCLEdBQTJCLGNBQUdBLENBQUgsQ0FBL0QsQ0FIRixFQUlFLG9CQUFJLE9BQU8sRUFBQyxHQUFHVixNQUFKO0FBQVlXLEVBQUFBLGNBQWMsRUFBRVAsSUFBRixhQUFFQSxJQUFGLHVCQUFFQSxJQUFJLENBQUVHO0FBQWxDLENBQVAsQ0FBSixDQUpGLEVBS0UsMEJBQVVOLFVBQVUsQ0FBQ1csTUFBckIsQ0FMRixDQVJLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHR5cGUge1NjaGVtYU9mfSBmcm9tICd5dXAnO1xuaW1wb3J0IHR5cGUge0F1dGhVc2VyLCBFbnRpdHksIFdyaXRlUmVwb3NpdG9yeX0gZnJvbSAnQGxpYi9pbnRlcmZhY2VzJztcblxuaW1wb3J0IHtvZn0gZnJvbSAncnhqcyc7XG5pbXBvcnQge21hcCwgc3dpdGNoTWFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge3ZhbGlkYXRlU2NoZW1hLCB2YWxpZGF0ZUVudGl0eUV4aXN0fSBmcm9tICdAbGliL2hlbHBlcnMnO1xuXG5leHBvcnQgY29uc3QgdXBkYXRlRW50aXR5OiA8SWQgPSBzdHJpbmcsIEUgZXh0ZW5kcyBFbnRpdHk8SWQ+ID0gRW50aXR5PElkPj4ocGFyYW1zOiB7XG4gIGVudGl0eToge2lkOiBJZH0gJiBQYXJ0aWFsPEU+O1xuICByZXBvc2l0b3J5OiBXcml0ZVJlcG9zaXRvcnk8SWQsIEU+O1xuICBzY2hlbWE/OiBTY2hlbWFPZjx1bmtub3duPjtcbiAgdmFsaWRhdGVQZXJtaXNzaW9uPzogKGVudGl0eToge2lkOiBJZH0gJiBQYXJ0aWFsPEU+KSA9PiBPYnNlcnZhYmxlPHtpZDogSWR9ICYgUGFydGlhbDxFPj47XG4gIHVzZXI6IEF1dGhVc2VyO1xuICBmaWVsZHM/OiBzdHJpbmdbXTtcbn0pID0+IE9ic2VydmFibGU8dm9pZD4gPSAoe2VudGl0eSwgcmVwb3NpdG9yeSwgc2NoZW1hLCB2YWxpZGF0ZVBlcm1pc3Npb24sIHVzZXIsIGZpZWxkc30pID0+XG4gIHZhbGlkYXRlU2NoZW1hPHR5cGVvZiBlbnRpdHk+KHNjaGVtYSkoZW50aXR5KS5waXBlKFxuICAgIHN3aXRjaE1hcCgoe2lkfSkgPT4gcmVwb3NpdG9yeS5nZXRCeUlkKHtpZCwgZmllbGRzOiBmaWVsZHMgfHwgWydpZCcsICdjcmVhdGVkQnknXX0pKSxcbiAgICBtYXAodmFsaWRhdGVFbnRpdHlFeGlzdCksXG4gICAgc3dpdGNoTWFwKChlKSA9PiAodmFsaWRhdGVQZXJtaXNzaW9uID8gdmFsaWRhdGVQZXJtaXNzaW9uKGUpIDogb2YoZSkpKSxcbiAgICBtYXAoKCkgPT4gKHsuLi5lbnRpdHksIGxhc3RNb2RpZmllZEJ5OiB1c2VyPy5pZH0pKSxcbiAgICBzd2l0Y2hNYXAocmVwb3NpdG9yeS51cGRhdGUpLFxuICApO1xuIl19