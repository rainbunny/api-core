"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.convertHandlersToResolvers = void 0;

var _fp = _interopRequireDefault(require("lodash/fp"));

var _graphqlFields = _interopRequireDefault(require("graphql-fields"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const convertQueryHandlerToResolver = queryHandler => (_parent, args, context, info) => {
  const fields = (0, _graphqlFields.default)(info, {}, {
    processArguments: true
  });
  return queryHandler({ ...args.query,
    fields
  }, context).toPromise();
};

const mapQueryHandlerPairsToResolverPairs = _fp.default.map(pair => [pair[0], convertQueryHandlerToResolver(pair[1])]);

const mergeQueryResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertQueryHandlers = _fp.default.pipe(_fp.default.toPairs, mapQueryHandlerPairsToResolverPairs, mergeQueryResolverPairsToObject);

const mergeCommandResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertCommandHandlerToResolver = commandHandler => (args, context, info) => {
  const fields = (0, _graphqlFields.default)(info, {}, {
    processArguments: true
  });
  return commandHandler({ ...args.payload,
    fields
  }, context).toPromise();
};

const mapCommandHandlerPairsToResolverPairs = _fp.default.map(pair => [pair[0], convertCommandHandlerToResolver(pair[1])]);

const convertEntityCommandHandlersToEntityResolvers = _fp.default.pipe(_fp.default.toPairs, mapCommandHandlerPairsToResolverPairs, mergeCommandResolverPairsToObject);

const mapEntityCommandHandlerPairsToEntityResolverPairs = _fp.default.map(pair => [pair[0], () => convertEntityCommandHandlersToEntityResolvers(pair[1])]);

const mergeEntityCommandHandlersResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertEntityCommandHandlers = _fp.default.pipe(_fp.default.toPairs, mapEntityCommandHandlerPairsToEntityResolverPairs, mergeEntityCommandHandlersResolverPairsToObject);

const convertHandlersToResolvers = handlers => ({
  Query: convertQueryHandlers(handlers.Query),
  Mutation: convertEntityCommandHandlers(handlers.Mutation)
});

exports.convertHandlersToResolvers = convertHandlersToResolvers;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2NvbnZlcnQtaGFuZGxlcnMtdG8tcmVzb2x2ZXJzLnRzIl0sIm5hbWVzIjpbImNvbnZlcnRRdWVyeUhhbmRsZXJUb1Jlc29sdmVyIiwicXVlcnlIYW5kbGVyIiwiX3BhcmVudCIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsImZpZWxkcyIsInByb2Nlc3NBcmd1bWVudHMiLCJxdWVyeSIsInRvUHJvbWlzZSIsIm1hcFF1ZXJ5SGFuZGxlclBhaXJzVG9SZXNvbHZlclBhaXJzIiwiXyIsIm1hcCIsInBhaXIiLCJtZXJnZVF1ZXJ5UmVzb2x2ZXJQYWlyc1RvT2JqZWN0IiwicmVkdWNlIiwiYWNjIiwiZWxlbWVudCIsImNvbnZlcnRRdWVyeUhhbmRsZXJzIiwicGlwZSIsInRvUGFpcnMiLCJtZXJnZUNvbW1hbmRSZXNvbHZlclBhaXJzVG9PYmplY3QiLCJjb252ZXJ0Q29tbWFuZEhhbmRsZXJUb1Jlc29sdmVyIiwiY29tbWFuZEhhbmRsZXIiLCJwYXlsb2FkIiwibWFwQ29tbWFuZEhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlycyIsImNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnNUb0VudGl0eVJlc29sdmVycyIsIm1hcEVudGl0eUNvbW1hbmRIYW5kbGVyUGFpcnNUb0VudGl0eVJlc29sdmVyUGFpcnMiLCJtZXJnZUVudGl0eUNvbW1hbmRIYW5kbGVyc1Jlc29sdmVyUGFpcnNUb09iamVjdCIsImNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnMiLCJjb252ZXJ0SGFuZGxlcnNUb1Jlc29sdmVycyIsImhhbmRsZXJzIiwiUXVlcnkiLCJNdXRhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBY0EsTUFBTUEsNkJBQTZCLEdBQ1BDLFlBQTFCLElBQ0EsQ0FBQ0MsT0FBRCxFQUFVQyxJQUFWLEVBQWdCQyxPQUFoQixFQUF5QkMsSUFBekIsS0FBa0M7QUFDaEMsUUFBTUMsTUFBTSxHQUFHLDRCQUFjRCxJ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QUNFLFFBQVEsQ0FBQ0UsUUFBVjtBQUYrQyxDQUE3QyxDQUFuQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaC9mcCc7XG5pbXBvcnQgZ3JhcGhxbEZpZWxkcyBmcm9tICdncmFwaHFsLWZpZWxkcyc7XG5pbXBvcnQgdHlwZSB7Q29tbWFuZCwgQ29tbWFuZEhhbmRsZXIsIENvbW1hbmRSZXNvbHZlciwgUXVlcnksIFF1ZXJ5SGFuZGxlciwgUXVlcnlSZXNvbHZlcn0gZnJvbSAnLi4vaW50ZXJmYWNlcyc7XG5cbmludGVyZmFjZSBIYW5kbGVyUGFyYW1zIHtcbiAgUXVlcnk6IHtbZW50aXR5TmFtZTogc3RyaW5nXTogUXVlcnlIYW5kbGVyfTtcbiAgTXV0YXRpb246IHtbZW50aXR5TmFtZTogc3RyaW5nXToge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZEhhbmRsZXJ9fTtcbn1cblxuaW50ZXJmYWNlIEhhbmRsZXJSZXN1bHQge1xuICBRdWVyeToge1tlbnRpdHlOYW1lOiBzdHJpbmddOiBRdWVyeVJlc29sdmVyfTtcbiAgTXV0YXRpb246IHtbZW50aXR5TmFtZTogc3RyaW5nXTogKCkgPT4ge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZFJlc29sdmVyfX07XG4gIFtrZXk6IHN0cmluZ106IHVua25vd247XG59XG5cbmNvbnN0IGNvbnZlcnRRdWVyeUhhbmRsZXJUb1Jlc29sdmVyID1cbiAgPFEgZXh0ZW5kcyBRdWVyeSA9IFF1ZXJ5PihxdWVyeUhhbmRsZXI6IFF1ZXJ5SGFuZGxlcjxRPik6IFF1ZXJ5UmVzb2x2ZXI8UT4gPT5cbiAgKF9wYXJlbnQsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcbiAgICBjb25zdCBmaWVsZHMgPSBncmFwaHFsRmllbGRzKGluZm8sIHt9LCB7cHJvY2Vzc0FyZ3VtZW50czogdHJ1ZX0pO1xuICAgIHJldHVybiBxdWVyeUhhbmRsZXIoey4uLmFyZ3MucXVlcnksIGZpZWxkc30sIGNvbnRleHQpLnRvUHJvbWlzZSgpO1xuICB9O1xuXG5jb25zdCBtYXBRdWVyeUhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlyczogKGxpc3Q6IFtzdHJpbmcsIFF1ZXJ5SGFuZGxlcl1bXSkgPT4gW3N0cmluZywgUXVlcnlSZXNvbHZlcl1bXSA9IF8ubWFwKFxuICAocGFpcikgPT4gW3BhaXJbMF0sIGNvbnZlcnRRdWVyeUhhbmRsZXJUb1Jlc29sdmVyKHBhaXJbMV0pXSxcbik7XG5cbmNvbnN0IG1lcmdlUXVlcnlSZXNvbHZlclBhaXJzVG9PYmplY3Q6IChwYWlyczogW3N0cmluZywgUXVlcnlSZXNvbHZlcl1bXSkgPT4ge1tlbnRpdHlOYW1lOiBzdHJpbmddOiBRdWVyeVJlc29sdmVyfSA9XG4gIF8ucmVkdWNlKChhY2MsIGVsZW1lbnQpID0+ICh7Li4uYWNjLCBbZWxlbWVudFswXV06IGVsZW1lbnRbMV19KSwge30pO1xuXG5jb25zdCBjb252ZXJ0UXVlcnlIYW5kbGVyczogKHF1ZXJ5SGFuZGxlcnM6IHtbZW50aXR5TmFtZTogc3RyaW5nXTogUXVlcnlIYW5kbGVyfSkgPT4ge1xuICBbZW50aXR5TmFtZTogc3RyaW5nXTogUXVlcnlSZXNvbHZlcjtcbn0gPSBfLnBpcGUoXy50b1BhaXJzLCBtYXBRdWVyeUhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlycywgbWVyZ2VRdWVyeVJlc29sdmVyUGFpcnNUb09iamVjdCk7XG5cbmNvbnN0IG1lcmdlQ29tbWFuZFJlc29sdmVyUGFpcnNUb09iamVjdDogKHBhaXJzOiBbc3RyaW5nLCBDb21tYW5kUmVzb2x2ZXJdW10pID0+IHtcbiAgW2VudGl0eU5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcjtcbn0gPSBfLnJlZHVjZSgoYWNjLCBlbGVtZW50KSA9PiAoey4uLmFjYywgW2VsZW1lbnRbMF1dOiBlbGVtZW50WzFdfSksIHt9KTtcblxuY29uc3QgY29udmVydENvbW1hbmRIYW5kbGVyVG9SZXNvbHZlciA9XG4gIDxDIGV4dGVuZHMgQ29tbWFuZD4oY29tbWFuZEhhbmRsZXI6IENvbW1hbmRIYW5kbGVyPEM+KTogQ29tbWFuZFJlc29sdmVyPEM+ID0+XG4gIChhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XG4gICAgY29uc3QgZmllbGRzID0gZ3JhcGhxbEZpZWxkcyhpbmZvLCB7fSwge3Byb2Nlc3NBcmd1bWVudHM6IHRydWV9KTtcbiAgICByZXR1cm4gY29tbWFuZEhhbmRsZXIoey4uLmFyZ3MucGF5bG9hZCwgZmllbGRzfSwgY29udGV4dCkudG9Qcm9taXNlKCk7XG4gIH07XG5cbmNvbnN0IG1hcENvbW1hbmRIYW5kbGVyUGFpcnNUb1Jlc29sdmVyUGFpcnM6IChsaXN0OiBbc3RyaW5nLCBDb21tYW5kSGFuZGxlcl1bXSkgPT4gW3N0cmluZywgQ29tbWFuZFJlc29sdmVyXVtdID0gXy5tYXAoXG4gIChwYWlyKSA9PiBbcGFpclswXSwgY29udmVydENvbW1hbmRIYW5kbGVyVG9SZXNvbHZlcihwYWlyWzFdKV0sXG4pO1xuXG5jb25zdCBjb252ZXJ0RW50aXR5Q29tbWFuZEhhbmRsZXJzVG9FbnRpdHlSZXNvbHZlcnM6IChlbnRpdHlDb21tYW5kSGFuZGxlcnM6IHtcbiAgW2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kSGFuZGxlcjtcbn0pID0+IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcn0gPSBfLnBpcGUoXG4gIF8udG9QYWlycyxcbiAgbWFwQ29tbWFuZEhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlycyxcbiAgbWVyZ2VDb21tYW5kUmVzb2x2ZXJQYWlyc1RvT2JqZWN0LFxuKTtcblxuY29uc3QgbWFwRW50aXR5Q29tbWFuZEhhbmRsZXJQYWlyc1RvRW50aXR5UmVzb2x2ZXJQYWlyczogKFxuICBsaXN0OiBbZW50aXR5TmFtZTogc3RyaW5nLCBlbnRpdHlDb21tYW5kSGFuZGxlcnM6IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRIYW5kbGVyfV1bXSxcbikgPT4gW2VudGl0eU5hbWU6IHN0cmluZywgZW50aXR5Q29tbWFuZFJlc29sdmVyczogKCkgPT4ge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZFJlc29sdmVyfV1bXSA9IF8ubWFwKChwYWlyKSA9PiBbXG4gIHBhaXJbMF0sXG4gICgpID0+IGNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnNUb0VudGl0eVJlc29sdmVycyhwYWlyWzFdKSxcbl0pO1xuXG5jb25zdCBtZXJnZUVudGl0eUNvbW1hbmRIYW5kbGVyc1Jlc29sdmVyUGFpcnNUb09iamVjdDogKFxuICBwYWlyczogW2VudGl0eU5hbWU6IHN0cmluZywgZW50aXR5Q29tbWFuZFJlc29sdmVyczogKCkgPT4ge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZFJlc29sdmVyfV1bXSxcbikgPT4ge1tlbnRpdHlOYW1lOiBzdHJpbmddOiAoKSA9PiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kUmVzb2x2ZXJ9fSA9IF8ucmVkdWNlKFxuICAoYWNjLCBlbGVtZW50KSA9PiAoey4uLmFjYywgW2VsZW1lbnRbMF1dOiBlbGVtZW50WzFdfSksXG4gIHt9LFxuKTtcblxuY29uc3QgY29udmVydEVudGl0eUNvbW1hbmRIYW5kbGVyczogKGNvbW1hbmRIYW5kbGVyczoge1xuICBbZW50aXR5TmFtZTogc3RyaW5nXToge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZEhhbmRsZXJ9O1xufSkgPT4ge1tlbnRpdHlOYW1lOiBzdHJpbmddOiAoKSA9PiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kUmVzb2x2ZXJ9fSA9IF8ucGlwZShcbiAgXy50b1BhaXJzLFxuICBtYXBFbnRpdHlDb21tYW5kSGFuZGxlclBhaXJzVG9FbnRpdHlSZXNvbHZlclBhaXJzLFxuICBtZXJnZUVudGl0eUNvbW1hbmRIYW5kbGVyc1Jlc29sdmVyUGFpcnNUb09iamVjdCxcbik7XG5cbmV4cG9ydCBjb25zdCBjb252ZXJ0SGFuZGxlcnNUb1Jlc29sdmVycyA9IChoYW5kbGVyczogSGFuZGxlclBhcmFtcyk6IEhhbmRsZXJSZXN1bHQgPT4gKHtcbiAgUXVlcnk6IGNvbnZlcnRRdWVyeUhhbmRsZXJzKGhhbmRsZXJzLlF1ZXJ5KSxcbiAgTXV0YXRpb246IGNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnMoaGFuZGxlcnMuTXV0YXRpb24pLFxufSk7XG4iXX0=