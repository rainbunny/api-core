"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.updateEntity = void 0;

var _helpers = require("../helpers");

const updateEntity = ({
  entity,
  repository,
  schema,
  validatePermissions,
  user,
  fields
}) => (0, _helpers.validateSchema)(schema)(entity).then(({
  id
}) => repository.getById({
  id,
  fields: fields || {
    id: {},
    createdBy: {}
  }
})).then(_helpers.validateEntityExist).then(e => validatePermissions ? validatePermissions(e) : Promise.resolve(e)).then(() => ({ ...entity,
  lastModifiedBy: user === null || user === void 0 ? void 0 : user.id
})).then(repository.update);

exports.updateEntity = updateEntity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy91cGRhdGUtZW50aXR5LnRzIl0sIm5hbWVzIjpbInVwZGF0ZUVudGl0eSIsImVudGl0eSIsInJlcG9zaXRvcnkiLCJzY2hlbWEiLCJ2YWxpZGF0ZVBlcm1pc3Npb25zIiwidXNlciIsImZpZWxkcyIsInRoZW4iLCJpZCIsImdldEJ5SWQiLCJjcmVhdGVkQnkiLCJ2YWxpZGF0ZUVudGl0eUV4aXN0IiwiZSIsIlByb21pc2UiLCJyZXNvbHZlIiwibGFzdE1vZGlmaWVkQnkiLCJ1cGRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7QUFFTyxNQUFNQSxZQU9NLEdBQUcsQ0FBQztBQUFDQyxFQUFBQSxNQUFEO0FBQVNDLEVBQUFBLFVBQVQ7QUFBcUJDLEVBQUFBLE1BQXJCO0FBQTZCQyxFQUFBQSxtQkFBN0I7QUFBa0RDLEVBQUFBLElBQWxEO0FBQXdEQyxFQUFBQTtBQUF4RCxDQUFELEtBQ3BCLDZCQUE4QkgsTUFBOUIsRUFBc0NGLE1BQXRDLEVBQ0dNLElBREgsQ0FDUSxDQUFDO0FBQUNDLEVBQUFBO0FBQUQsQ0FBRCxLQUFVTixVQUFVLENBQUNPLE9BQVgsQ0FBbUI7QUFBQ0QsRUFBQUEsRUFBRDtBQUFLRixFQUFBQSxNQUFNLEVBQUVBLE1BQU0sSUFBSTtBQUFDRSxJQUFBQSxFQUFFLEVBQUUsRUFBTDtBQUFTRSxJQUFBQSxTQUFTLEVBQUU7QUFBcEI7QUFBdkIsQ0FBbkIsQ0FEbEIsRUFFR0gsSUFGSCxDQUVRSSw0QkFGUixFQUdHSixJQUhILENBR1NLLENBQUQsSUFBUVIsbUJBQW1CLEdBQUdBLG1CQUFtQixDQUFDUSxDQUFELENBQXRCLEdBQTRCQyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0JGLENBQWhCLENBSC9ELEVBSUdMLElBSkgsQ0FJUSxPQUFPLEVBQUMsR0FBR04sTUFBSjtBQUFZYyxFQUFBQSxjQUFjLEVBQUVWLElBQUYsYUFBRUEsSUFBRix1QkFBRUEsSUFBSSxDQUFFRztBQUFsQyxDQUFQLENBSlIsRUFLR0QsSUFMSCxDQUtRTCxVQUFVLENBQUNjLE1BTG5CLENBUksiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7U2NoZW1hT2Z9IGZyb20gJ3l1cCc7XG5pbXBvcnQgdHlwZSB7QXV0aFVzZXIsIEVudGl0eSwgRmllbGRzLCBXcml0ZVJlcG9zaXRvcnl9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHt2YWxpZGF0ZVNjaGVtYSwgdmFsaWRhdGVFbnRpdHlFeGlzdH0gZnJvbSAnLi4vaGVscGVycyc7XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVFbnRpdHk6IDxJZCA9IHN0cmluZywgRSBleHRlbmRzIEVudGl0eTxJZD4gPSBFbnRpdHk8SWQ+PihwYXJhbXM6IHtcbiAgZW50aXR5OiB7aWQ6IElkfSAmIFBhcnRpYWw8RT47XG4gIHJlcG9zaXRvcnk6IFdyaXRlUmVwb3NpdG9yeTxJZCwgRT47XG4gIHNjaGVtYT86IFNjaGVtYU9mPHVua25vd24+O1xuICB2YWxpZGF0ZVBlcm1pc3Npb25zPzogKGVudGl0eToge2lkOiBJZH0gJiBQYXJ0aWFsPEU+KSA9PiBQcm9taXNlPHtpZDogSWR9ICYgUGFydGlhbDxFPj47XG4gIHVzZXI6IEF1dGhVc2VyO1xuICBmaWVsZHM/OiBGaWVsZHM7XG59KSA9PiBQcm9taXNlPHZvaWQ+ID0gKHtlbnRpdHksIHJlcG9zaXRvcnksIHNjaGVtYSwgdmFsaWRhdGVQZXJtaXNzaW9ucywgdXNlciwgZmllbGRzfSkgPT5cbiAgdmFsaWRhdGVTY2hlbWE8dHlwZW9mIGVudGl0eT4oc2NoZW1hKShlbnRpdHkpXG4gICAgLnRoZW4oKHtpZH0pID0+IHJlcG9zaXRvcnkuZ2V0QnlJZCh7aWQsIGZpZWxkczogZmllbGRzIHx8IHtpZDoge30sIGNyZWF0ZWRCeToge319fSkpXG4gICAgLnRoZW4odmFsaWRhdGVFbnRpdHlFeGlzdClcbiAgICAudGhlbigoZSkgPT4gKHZhbGlkYXRlUGVybWlzc2lvbnMgPyB2YWxpZGF0ZVBlcm1pc3Npb25zKGUpIDogUHJvbWlzZS5yZXNvbHZlKGUpKSlcbiAgICAudGhlbigoKSA9PiAoey4uLmVudGl0eSwgbGFzdE1vZGlmaWVkQnk6IHVzZXI/LmlkfSkpXG4gICAgLnRoZW4ocmVwb3NpdG9yeS51cGRhdGUpO1xuIl19