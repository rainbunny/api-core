"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.contextFactory = void 0;

const contextFactory = ({
  firebaseApp
}) => ({
  req
}) => firebaseApp.auth().verifyIdToken(req.headers.authorization || '').then(decodedIdToken => decodedIdToken.id ? {
  user: {
    id: decodedIdToken.id,
    roles: decodedIdToken.roles,
    permissions: decodedIdToken.permissions
  }
} : {
  user: undefined
}).catch(() => ({
  user: undefined
}));

exports.contextFactory = contextFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2NvbnRleHQtZmFjdG9yeS50cyJdLCJuYW1lcyI6WyJjb250ZXh0RmFjdG9yeSIsImZpcmViYXNlQXBwIiwicmVxIiwiYXV0aCIsInZlcmlmeUlkVG9rZW4iLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInRoZW4iLCJkZWNvZGVkSWRUb2tlbiIsImlkIiwidXNlciIsInJvbGVzIiwicGVybWlzc2lvbnMiLCJ1bmRlZmluZWQiLCJjYXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUlPLE1BQU1BLGNBQW9HLEdBQUcsQ0FBQztBQUNuSEMsRUFBQUE7QUFEbUgsQ0FBRCxLQUU5RyxDQUFDO0FBQUNDLEVBQUFBO0FBQUQsQ0FBRCxLQUNKRCxXQUFXLENBQ1JFLElBREgsR0FFR0MsYUFGSCxDQUVpQkYsR0FBRyxDQUFDRyxPQUFKLENBQVlDLGFBQVosSUFBNkIsRUFGOUMsRUFHR0MsSUFISCxDQUdTQyxjQUFELElBQ0pBLGNBQWMsQ0FBQ0MsRUFBZixHQUNJO0FBQ0VDLEVBQUFBLElBQUksRUFBRTtBQUNKRCxJQUFBQSxFQUFFLEVBQUVELGNBQWMsQ0FBQ0MsRUFEZjtBQUVKRSxJQUFBQSxLQUFLLEVBQUVILGNBQWMsQ0FBQ0csS0FGbEI7QUFHSkMsSUFBQUEsV0FBVyxFQUFFSixjQUFjLENBQUNJO0FBSHhCO0FBRFIsQ0FESixHQVFJO0FBQUNGLEVBQUFBLElBQUksRUFBRUc7QUFBUCxDQVpSLEVBY0dDLEtBZEgsQ0FjUyxPQUFPO0FBQUNKLEVBQUFBLElBQUksRUFBRUc7QUFBUCxDQUFQLENBZFQsQ0FISyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtBcG9sbG9TZXJ2ZXJFeHByZXNzQ29uZmlnfSBmcm9tICdhcG9sbG8tc2VydmVyLWV4cHJlc3MnO1xuaW1wb3J0ICogYXMgZmlyZWJhc2VBZG1pbiBmcm9tICdmaXJlYmFzZS1hZG1pbic7XG5pbXBvcnQgdHlwZSB7QXV0aFVzZXJ9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgY29uc3QgY29udGV4dEZhY3Rvcnk6IChkZXBzOiB7ZmlyZWJhc2VBcHA6IGZpcmViYXNlQWRtaW4uYXBwLkFwcH0pID0+IEFwb2xsb1NlcnZlckV4cHJlc3NDb25maWdbJ2NvbnRleHQnXSA9ICh7XG4gIGZpcmViYXNlQXBwLFxufSkgPT4gKHtyZXF9KTogUHJvbWlzZTx7dXNlcjogQXV0aFVzZXJ9PiA9PlxuICBmaXJlYmFzZUFwcFxuICAgIC5hdXRoKClcbiAgICAudmVyaWZ5SWRUb2tlbihyZXEuaGVhZGVycy5hdXRob3JpemF0aW9uIHx8ICcnKVxuICAgIC50aGVuKChkZWNvZGVkSWRUb2tlbikgPT5cbiAgICAgIGRlY29kZWRJZFRva2VuLmlkXG4gICAgICAgID8ge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBpZDogZGVjb2RlZElkVG9rZW4uaWQsXG4gICAgICAgICAgICAgIHJvbGVzOiBkZWNvZGVkSWRUb2tlbi5yb2xlcyxcbiAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IGRlY29kZWRJZFRva2VuLnBlcm1pc3Npb25zLFxuICAgICAgICAgICAgfSBhcyBBdXRoVXNlcixcbiAgICAgICAgICB9XG4gICAgICAgIDoge3VzZXI6IHVuZGVmaW5lZH0sXG4gICAgKVxuICAgIC5jYXRjaCgoKSA9PiAoe3VzZXI6IHVuZGVmaW5lZH0pKTtcbiJdfQ==