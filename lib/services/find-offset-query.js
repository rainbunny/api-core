"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.findOffsetQuery = void 0;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _helpers = require("../helpers");

const findInRepository = repository => query => (0, _rxjs.zip)(repository.find(query), repository.count(query)).pipe((0, _operators.map)(([data, total]) => ({
  data,
  pagination: {
    total,
    rowsPerPage: query.rowsPerPage,
    pageIndex: query.pageIndex
  }
})));

const findOffsetQuery = ({
  query,
  repository,
  querySchema
}) => (0, _rxjs.of)(query).pipe((0, _operators.map)(_helpers.sanitizeOffsetQuery), (0, _operators.switchMap)((0, _helpers.validateSchema)(querySchema)), (0, _operators.switchMap)(findInRepository(repository)));

exports.findOffsetQuery = findOffsetQuery;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9maW5kLW9mZnNldC1xdWVyeS50cyJdLCJuYW1lcyI6WyJmaW5kSW5SZXBvc2l0b3J5IiwicmVwb3NpdG9yeSIsInF1ZXJ5IiwiZmluZCIsImNvdW50IiwicGlwZSIsImRhdGEiLCJ0b3RhbCIsInBhZ2luYXRpb24iLCJyb3dzUGVyUGFnZSIsInBhZ2VJbmRleCIsImZpbmRPZmZzZXRRdWVyeSIsInF1ZXJ5U2NoZW1hIiwic2FuaXRpemVPZmZzZXRRdWVyeSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUlBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLGdCQUFnQixHQUNwQkMsVUFEdUIsSUFFbkJDLEtBQUQsSUFDSCxlQUFJRCxVQUFVLENBQUNFLElBQVgsQ0FBZ0JELEtBQWhCLENBQUosRUFBNEJELFVBQVUsQ0FBQ0csS0FBWCxDQUFpQkYsS0FBakIsQ0FBNUIsRUFBcURHLElBQXJELENBQ0Usb0JBQUksQ0FBQyxDQUFDQyxJQUFELEVBQU9DLEtBQVAsQ0FBRCxNQUFvQjtBQUN0QkQsRUFBQUEsSUFEc0I7QUFFdEJFLEVBQUFBLFVBQVUsRUFBRTtBQUNWRCxJQUFBQSxLQURVO0FBRVZFLElBQUFBLFdBQVcsRUFBRVAsS0FBSyxDQUFDTyxXQUZUO0FBR1ZDLElBQUFBLFNBQVMsRUFBRVIsS0FBSyxDQUFDUTtBQUhQO0FBRlUsQ0FBcEIsQ0FBSixDQURGLENBSEY7O0FBY08sTUFBTUMsZUFTNkIsR0FBRyxDQUFDO0FBQUNULEVBQUFBLEtBQUQ7QUFBUUQsRUFBQUEsVUFBUjtBQUFvQlcsRUFBQUE7QUFBcEIsQ0FBRCxLQUMzQyxjQUFHVixLQUFILEVBQVVHLElBQVYsQ0FDRSxvQkFBSVEsNEJBQUosQ0FERixFQUVFLDBCQUFVLDZCQUFlRCxXQUFmLENBQVYsQ0FGRixFQUdFLDBCQUFVWixnQkFBZ0IsQ0FBQ0MsVUFBRCxDQUExQixDQUhGLENBVksiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQgdHlwZSB7RW50aXR5LCBPZmZzZXRRdWVyeSwgT2Zmc2V0UXVlcnlSZXN1bHQsIFJlYWRSZXBvc2l0b3J5fSBmcm9tICdAbGliL2ludGVyZmFjZXMnO1xuaW1wb3J0IHR5cGUge1NjaGVtYU9mfSBmcm9tICd5dXAnO1xuXG5pbXBvcnQge29mLCB6aXB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHttYXAsIHN3aXRjaE1hcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtzYW5pdGl6ZU9mZnNldFF1ZXJ5LCB2YWxpZGF0ZVNjaGVtYX0gZnJvbSAnQGxpYi9oZWxwZXJzJztcblxuY29uc3QgZmluZEluUmVwb3NpdG9yeSA9IDxJZCA9IHN0cmluZywgRSBleHRlbmRzIEVudGl0eTxJZD4gPSBFbnRpdHk8SWQ+LCBRIGV4dGVuZHMgT2Zmc2V0UXVlcnkgPSBPZmZzZXRRdWVyeT4oXG4gIHJlcG9zaXRvcnk6IFJlYWRSZXBvc2l0b3J5PElkLCBFPixcbikgPT4gKHF1ZXJ5OiBRKTogT2JzZXJ2YWJsZTxPZmZzZXRRdWVyeVJlc3VsdDxJZCwgRT4+ID0+XG4gIHppcChyZXBvc2l0b3J5LmZpbmQocXVlcnkpLCByZXBvc2l0b3J5LmNvdW50KHF1ZXJ5KSkucGlwZShcbiAgICBtYXAoKFtkYXRhLCB0b3RhbF0pID0+ICh7XG4gICAgICBkYXRhLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICB0b3RhbCxcbiAgICAgICAgcm93c1BlclBhZ2U6IHF1ZXJ5LnJvd3NQZXJQYWdlLFxuICAgICAgICBwYWdlSW5kZXg6IHF1ZXJ5LnBhZ2VJbmRleCxcbiAgICAgIH0sXG4gICAgfSkpLFxuICApO1xuXG5leHBvcnQgY29uc3QgZmluZE9mZnNldFF1ZXJ5OiA8XG4gIElkID0gc3RyaW5nLFxuICBFIGV4dGVuZHMgRW50aXR5PElkPiA9IEVudGl0eTxJZD4sXG4gIFEgZXh0ZW5kcyBPZmZzZXRRdWVyeSA9IE9mZnNldFF1ZXJ5XG4+KHBhcmFtczoge1xuICBxdWVyeTogUTtcbiAgZGVmYXVsdFF1ZXJ5PzogUGFydGlhbDxRPjtcbiAgcmVwb3NpdG9yeTogUmVhZFJlcG9zaXRvcnk8SWQsIEU+O1xuICBxdWVyeVNjaGVtYTogU2NoZW1hT2Y8dW5rbm93bj47XG59KSA9PiBPYnNlcnZhYmxlPE9mZnNldFF1ZXJ5UmVzdWx0PElkLCBFPj4gPSAoe3F1ZXJ5LCByZXBvc2l0b3J5LCBxdWVyeVNjaGVtYX0pID0+XG4gIG9mKHF1ZXJ5KS5waXBlKFxuICAgIG1hcChzYW5pdGl6ZU9mZnNldFF1ZXJ5KSxcbiAgICBzd2l0Y2hNYXAodmFsaWRhdGVTY2hlbWEocXVlcnlTY2hlbWEpKSxcbiAgICBzd2l0Y2hNYXAoZmluZEluUmVwb3NpdG9yeShyZXBvc2l0b3J5KSksXG4gICk7XG4iXX0=