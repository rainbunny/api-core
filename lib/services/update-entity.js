"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.updateEntity = void 0;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _helpers = require("../helpers");

const updateEntity = ({
  entity,
  repository,
  schema,
  validatePermission,
  user,
  fields
}) => (0, _helpers.validateSchema)(schema)(entity).pipe((0, _operators.switchMap)(({
  id
}) => repository.getById({
  id,
  fields: fields || {
    id: {},
    createdBy: {}
  }
})), (0, _operators.map)(_helpers.validateEntityExist), (0, _operators.switchMap)(e => validatePermission ? validatePermission(e) : (0, _rxjs.of)(e)), (0, _operators.map)(() => ({ ...entity,
  lastModifiedBy: user === null || user === void 0 ? void 0 : user.id
})), (0, _operators.switchMap)(repository.update));

exports.updateEntity = updateEntity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy91cGRhdGUtZW50aXR5LnRzIl0sIm5hbWVzIjpbInVwZGF0ZUVudGl0eSIsImVudGl0eSIsInJlcG9zaXRvcnkiLCJzY2hlbWEiLCJ2YWxpZGF0ZVBlcm1pc3Npb24iLCJ1c2VyIiwiZmllbGRzIiwicGlwZSIsImlkIiwiZ2V0QnlJZCIsImNyZWF0ZWRCeSIsInZhbGlkYXRlRW50aXR5RXhpc3QiLCJlIiwibGFzdE1vZGlmaWVkQnkiLCJ1cGRhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFJQTs7QUFDQTs7QUFDQTs7QUFFTyxNQUFNQSxZQU9TLEdBQUcsQ0FBQztBQUFDQyxFQUFBQSxNQUFEO0FBQVNDLEVBQUFBLFVBQVQ7QUFBcUJDLEVBQUFBLE1BQXJCO0FBQTZCQyxFQUFBQSxrQkFBN0I7QUFBaURDLEVBQUFBLElBQWpEO0FBQXVEQyxFQUFBQTtBQUF2RCxDQUFELEtBQ3ZCLDZCQUE4QkgsTUFBOUIsRUFBc0NGLE1BQXRDLEVBQThDTSxJQUE5QyxDQUNFLDBCQUFVLENBQUM7QUFBQ0MsRUFBQUE7QUFBRCxDQUFELEtBQVVOLFVBQVUsQ0FBQ08sT0FBWCxDQUFtQjtBQUFDRCxFQUFBQSxFQUFEO0FBQUtGLEVBQUFBLE1BQU0sRUFBRUEsTUFBTSxJQUFJO0FBQUNFLElBQUFBLEVBQUUsRUFBRSxFQUFMO0FBQVNFLElBQUFBLFNBQVMsRUFBRTtBQUFwQjtBQUF2QixDQUFuQixDQUFwQixDQURGLEVBRUUsb0JBQUlDLDRCQUFKLENBRkYsRUFHRSwwQkFBV0MsQ0FBRCxJQUFRUixrQkFBa0IsR0FBR0Esa0JBQWtCLENBQUNRLENBQUQsQ0FBckIsR0FBMkIsY0FBR0EsQ0FBSCxDQUEvRCxDQUhGLEVBSUUsb0JBQUksT0FBTyxFQUFDLEdBQUdYLE1BQUo7QUFBWVksRUFBQUEsY0FBYyxFQUFFUixJQUFGLGFBQUVBLElBQUYsdUJBQUVBLElBQUksQ0FBRUc7QUFBbEMsQ0FBUCxDQUFKLENBSkYsRUFLRSwwQkFBVU4sVUFBVSxDQUFDWSxNQUFyQixDQUxGLENBUksiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQgdHlwZSB7U2NoZW1hT2Z9IGZyb20gJ3l1cCc7XG5pbXBvcnQgdHlwZSB7QXV0aFVzZXIsIEVudGl0eSwgRmllbGRzLCBXcml0ZVJlcG9zaXRvcnl9IGZyb20gJ0BsaWIvaW50ZXJmYWNlcyc7XG5cbmltcG9ydCB7b2Z9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHttYXAsIHN3aXRjaE1hcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHt2YWxpZGF0ZVNjaGVtYSwgdmFsaWRhdGVFbnRpdHlFeGlzdH0gZnJvbSAnQGxpYi9oZWxwZXJzJztcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUVudGl0eTogPElkID0gc3RyaW5nLCBFIGV4dGVuZHMgRW50aXR5PElkPiA9IEVudGl0eTxJZD4+KHBhcmFtczoge1xuICBlbnRpdHk6IHtpZDogSWR9ICYgUGFydGlhbDxFPjtcbiAgcmVwb3NpdG9yeTogV3JpdGVSZXBvc2l0b3J5PElkLCBFPjtcbiAgc2NoZW1hPzogU2NoZW1hT2Y8dW5rbm93bj47XG4gIHZhbGlkYXRlUGVybWlzc2lvbj86IChlbnRpdHk6IHtpZDogSWR9ICYgUGFydGlhbDxFPikgPT4gT2JzZXJ2YWJsZTx7aWQ6IElkfSAmIFBhcnRpYWw8RT4+O1xuICB1c2VyOiBBdXRoVXNlcjtcbiAgZmllbGRzPzogRmllbGRzO1xufSkgPT4gT2JzZXJ2YWJsZTx2b2lkPiA9ICh7ZW50aXR5LCByZXBvc2l0b3J5LCBzY2hlbWEsIHZhbGlkYXRlUGVybWlzc2lvbiwgdXNlciwgZmllbGRzfSkgPT5cbiAgdmFsaWRhdGVTY2hlbWE8dHlwZW9mIGVudGl0eT4oc2NoZW1hKShlbnRpdHkpLnBpcGUoXG4gICAgc3dpdGNoTWFwKCh7aWR9KSA9PiByZXBvc2l0b3J5LmdldEJ5SWQoe2lkLCBmaWVsZHM6IGZpZWxkcyB8fCB7aWQ6IHt9LCBjcmVhdGVkQnk6IHt9fX0pKSxcbiAgICBtYXAodmFsaWRhdGVFbnRpdHlFeGlzdCksXG4gICAgc3dpdGNoTWFwKChlKSA9PiAodmFsaWRhdGVQZXJtaXNzaW9uID8gdmFsaWRhdGVQZXJtaXNzaW9uKGUpIDogb2YoZSkpKSxcbiAgICBtYXAoKCkgPT4gKHsuLi5lbnRpdHksIGxhc3RNb2RpZmllZEJ5OiB1c2VyPy5pZH0pKSxcbiAgICBzd2l0Y2hNYXAocmVwb3NpdG9yeS51cGRhdGUpLFxuICApO1xuIl19