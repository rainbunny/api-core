"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.convertHandlersToResolvers = void 0;

var _fp = _interopRequireDefault(require("lodash/fp"));

var _graphqlFields = _interopRequireDefault(require("graphql-fields"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const convertQueryHandlerToResolver = queryHandler => (_parent, args, context, info) => {
  const fields = (0, _graphqlFields.default)(info, {}, {
    processArguments: true
  });
  return queryHandler({ ...args.query,
    fields
  }, context).toPromise();
};

const mapQueryHandlerPairsToResolverPairs = _fp.default.map(pair => [pair[0], convertQueryHandlerToResolver(pair[1])]);

const mergeQueryResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertQueryHandlers = _fp.default.pipe(_fp.default.toPairs, mapQueryHandlerPairsToResolverPairs, mergeQueryResolverPairsToObject);

const mergeCommandResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertCommandHandlerToResolver = commandHandler => (args, context, info) => {
  const fields = (0, _graphqlFields.default)(info, {}, {
    processArguments: true
  });
  return commandHandler({ ...args.payload,
    fields
  }, context).toPromise();
};

const mapCommandHandlerPairsToResolverPairs = _fp.default.map(pair => [pair[0], convertCommandHandlerToResolver(pair[1])]);

const convertEntityCommandHandlersToEntityResolvers = _fp.default.pipe(_fp.default.toPairs, mapCommandHandlerPairsToResolverPairs, mergeCommandResolverPairsToObject);

const mapEntityCommandHandlerPairsToEntityResolverPairs = _fp.default.map(pair => [pair[0], () => convertEntityCommandHandlersToEntityResolvers(pair[1])]);

const mergeEntityCommandHandlersResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertEntityCommandHandlers = _fp.default.pipe(_fp.default.toPairs, mapEntityCommandHandlerPairsToEntityResolverPairs, mergeEntityCommandHandlersResolverPairsToObject);

const convertHandlersToResolvers = handlers => ({
  Query: convertQueryHandlers(handlers.Query),
  Mutation: convertEntityCommandHandlers(handlers.Mutation)
});

exports.convertHandlersToResolvers = convertHandlersToResolvers;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2NvbnZlcnQtaGFuZGxlcnMtdG8tcmVzb2x2ZXJzLnRzIl0sIm5hbWVzIjpbImNvbnZlcnRRdWVyeUhhbmRsZXJUb1Jlc29sdmVyIiwicXVlcnlIYW5kbGVyIiwiX3BhcmVudCIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsImZpZWxkcyIsInByb2Nlc3NBcmd1bWVudHMiLCJxdWVyeSIsInRvUHJvbWlzZSIsIm1hcFF1ZXJ5SGFuZGxlclBhaXJzVG9SZXNvbHZlclBhaXJzIiwiXyIsIm1hcCIsInBhaXIiLCJtZXJnZVF1ZXJ5UmVzb2x2ZXJQYWlyc1RvT2JqZWN0IiwicmVkdWNlIiwiYWNjIiwiZWxlbWVudCIsImNvbnZlcnRRdWVyeUhhbmRsZXJzIiwicGlwZSIsInRvUGFpcnMiLCJtZXJnZUNvbW1hbmRSZXNvbHZlclBhaXJzVG9PYmplY3QiLCJjb252ZXJ0Q29tbWFuZEhhbmRsZXJUb1Jlc29sdmVyIiwiY29tbWFuZEhhbmRsZXIiLCJwYXlsb2FkIiwibWFwQ29tbWFuZEhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlycyIsImNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnNUb0VudGl0eVJlc29sdmVycyIsIm1hcEVudGl0eUNvbW1hbmRIYW5kbGVyUGFpcnNUb0VudGl0eVJlc29sdmVyUGFpcnMiLCJtZXJnZUVudGl0eUNvbW1hbmRIYW5kbGVyc1Jlc29sdmVyUGFpcnNUb09iamVjdCIsImNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnMiLCJjb252ZXJ0SGFuZGxlcnNUb1Jlc29sdmVycyIsImhhbmRsZXJzIiwiUXVlcnkiLCJNdXRhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVVBOztBQUNBOzs7O0FBYUEsTUFBTUEsNkJBQTZCLEdBTWpDQyxZQU5vQyxJQU9BLENBQUNDLE9BQUQsRUFBVUMsSUFBVixFQUFnQkMsT0FBaEIsRUFBeUJDLElBQXpCLEtBQWtDO0FBQ3RFLFFBQU1DLE1BQU0sR0FBRyw0QkFBY0Qs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LDRCQUE0QixDQUFDRSxRQUFRLENBQUNFLFFBQVY7QUFGK0MsQ0FBN0MsQ0FBbkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7XG4gIENvbW1hbmQsXG4gIENvbW1hbmRIYW5kbGVyLFxuICBDb21tYW5kUmVzb2x2ZXIsXG4gIEVudGl0eSxcbiAgUXVlcnksXG4gIFF1ZXJ5SGFuZGxlcixcbiAgUXVlcnlSZXNvbHZlcixcbiAgUXVlcnlSZXN1bHQsXG59IGZyb20gJ0BsaWIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gvZnAnO1xuaW1wb3J0IGdyYXBocWxGaWVsZHMgZnJvbSAnZ3JhcGhxbC1maWVsZHMnO1xuXG5pbnRlcmZhY2UgSGFuZGxlclBhcmFtcyB7XG4gIFF1ZXJ5OiB7W2VudGl0eU5hbWU6IHN0cmluZ106IFF1ZXJ5SGFuZGxlcn07XG4gIE11dGF0aW9uOiB7W2VudGl0eU5hbWU6IHN0cmluZ106IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRIYW5kbGVyfX07XG59XG5cbmludGVyZmFjZSBIYW5kbGVyUmVzdWx0IHtcbiAgUXVlcnk6IHtbZW50aXR5TmFtZTogc3RyaW5nXTogUXVlcnlSZXNvbHZlcn07XG4gIE11dGF0aW9uOiB7W2VudGl0eU5hbWU6IHN0cmluZ106ICgpID0+IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcn19O1xuICBba2V5OiBzdHJpbmddOiB1bmtub3duO1xufVxuXG5jb25zdCBjb252ZXJ0UXVlcnlIYW5kbGVyVG9SZXNvbHZlciA9IDxcbiAgSWQgPSBzdHJpbmcsXG4gIEUgZXh0ZW5kcyBFbnRpdHk8SWQ+ID0gRW50aXR5PElkPixcbiAgUSBleHRlbmRzIFF1ZXJ5ID0gUXVlcnksXG4gIFJlc3VsdCBleHRlbmRzIFF1ZXJ5UmVzdWx0PEU+IHwgRSA9IFF1ZXJ5UmVzdWx0PEU+IHwgRVxuPihcbiAgcXVlcnlIYW5kbGVyOiBRdWVyeUhhbmRsZXI8SWQsIEUsIFEsIFJlc3VsdD4sXG4pOiBRdWVyeVJlc29sdmVyPElkLCBFLCBRLCBSZXN1bHQ+ID0+IChfcGFyZW50LCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XG4gIGNvbnN0IGZpZWxkcyA9IGdyYXBocWxGaWVsZHMoaW5mbywge30sIHtwcm9jZXNzQXJndW1lbnRzOiB0cnVlfSk7XG4gIHJldHVybiBxdWVyeUhhbmRsZXIoey4uLmFyZ3MucXVlcnksIGZpZWxkc30sIGNvbnRleHQpLnRvUHJvbWlzZSgpO1xufTtcblxuY29uc3QgbWFwUXVlcnlIYW5kbGVyUGFpcnNUb1Jlc29sdmVyUGFpcnM6IChcbiAgbGlzdDogW3N0cmluZywgUXVlcnlIYW5kbGVyXVtdLFxuKSA9PiBbc3RyaW5nLCBRdWVyeVJlc29sdmVyXVtdID0gXy5tYXAoKHBhaXIpID0+IFtwYWlyWzBdLCBjb252ZXJ0UXVlcnlIYW5kbGVyVG9SZXNvbHZlcihwYWlyWzFdKV0pO1xuXG5jb25zdCBtZXJnZVF1ZXJ5UmVzb2x2ZXJQYWlyc1RvT2JqZWN0OiAoXG4gIHBhaXJzOiBbc3RyaW5nLCBRdWVyeVJlc29sdmVyXVtdLFxuKSA9PiB7W2VudGl0eU5hbWU6IHN0cmluZ106IFF1ZXJ5UmVzb2x2ZXJ9ID0gXy5yZWR1Y2UoKGFjYywgZWxlbWVudCkgPT4gKHsuLi5hY2MsIFtlbGVtZW50WzBdXTogZWxlbWVudFsxXX0pLCB7fSk7XG5cbmNvbnN0IGNvbnZlcnRRdWVyeUhhbmRsZXJzOiAocXVlcnlIYW5kbGVyczoge1xuICBbZW50aXR5TmFtZTogc3RyaW5nXTogUXVlcnlIYW5kbGVyO1xufSkgPT4ge1tlbnRpdHlOYW1lOiBzdHJpbmddOiBRdWVyeVJlc29sdmVyfSA9IF8ucGlwZShcbiAgXy50b1BhaXJzLFxuICBtYXBRdWVyeUhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlycyxcbiAgbWVyZ2VRdWVyeVJlc29sdmVyUGFpcnNUb09iamVjdCxcbik7XG5cbmNvbnN0IG1lcmdlQ29tbWFuZFJlc29sdmVyUGFpcnNUb09iamVjdDogKFxuICBwYWlyczogW3N0cmluZywgQ29tbWFuZFJlc29sdmVyXVtdLFxuKSA9PiB7W2VudGl0eU5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcn0gPSBfLnJlZHVjZSgoYWNjLCBlbGVtZW50KSA9PiAoey4uLmFjYywgW2VsZW1lbnRbMF1dOiBlbGVtZW50WzFdfSksIHt9KTtcblxuY29uc3QgY29udmVydENvbW1hbmRIYW5kbGVyVG9SZXNvbHZlciA9IDxDIGV4dGVuZHMgQ29tbWFuZD4oY29tbWFuZEhhbmRsZXI6IENvbW1hbmRIYW5kbGVyPEM+KTogQ29tbWFuZFJlc29sdmVyPEM+ID0+IChcbiAgYXJncyxcbiAgY29udGV4dCxcbiAgaW5mbyxcbikgPT4ge1xuICBjb25zdCBmaWVsZHMgPSBncmFwaHFsRmllbGRzKGluZm8sIHt9LCB7cHJvY2Vzc0FyZ3VtZW50czogdHJ1ZX0pO1xuICByZXR1cm4gY29tbWFuZEhhbmRsZXIoey4uLmFyZ3MucGF5bG9hZCwgZmllbGRzfSwgY29udGV4dCkudG9Qcm9taXNlKCk7XG59O1xuXG5jb25zdCBtYXBDb21tYW5kSGFuZGxlclBhaXJzVG9SZXNvbHZlclBhaXJzOiAoXG4gIGxpc3Q6IFtzdHJpbmcsIENvbW1hbmRIYW5kbGVyXVtdLFxuKSA9PiBbc3RyaW5nLCBDb21tYW5kUmVzb2x2ZXJdW10gPSBfLm1hcCgocGFpcikgPT4gW3BhaXJbMF0sIGNvbnZlcnRDb21tYW5kSGFuZGxlclRvUmVzb2x2ZXIocGFpclsxXSldKTtcblxuY29uc3QgY29udmVydEVudGl0eUNvbW1hbmRIYW5kbGVyc1RvRW50aXR5UmVzb2x2ZXJzOiAoZW50aXR5Q29tbWFuZEhhbmRsZXJzOiB7XG4gIFtjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZEhhbmRsZXI7XG59KSA9PiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kUmVzb2x2ZXJ9ID0gXy5waXBlKFxuICBfLnRvUGFpcnMsXG4gIG1hcENvbW1hbmRIYW5kbGVyUGFpcnNUb1Jlc29sdmVyUGFpcnMsXG4gIG1lcmdlQ29tbWFuZFJlc29sdmVyUGFpcnNUb09iamVjdCxcbik7XG5cbmNvbnN0IG1hcEVudGl0eUNvbW1hbmRIYW5kbGVyUGFpcnNUb0VudGl0eVJlc29sdmVyUGFpcnM6IChcbiAgbGlzdDogW2VudGl0eU5hbWU6IHN0cmluZywgZW50aXR5Q29tbWFuZEhhbmRsZXJzOiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kSGFuZGxlcn1dW10sXG4pID0+IFtlbnRpdHlOYW1lOiBzdHJpbmcsIGVudGl0eUNvbW1hbmRSZXNvbHZlcnM6ICgpID0+IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcn1dW10gPSBfLm1hcCgocGFpcikgPT4gW1xuICBwYWlyWzBdLFxuICAoKSA9PiBjb252ZXJ0RW50aXR5Q29tbWFuZEhhbmRsZXJzVG9FbnRpdHlSZXNvbHZlcnMocGFpclsxXSksXG5dKTtcblxuY29uc3QgbWVyZ2VFbnRpdHlDb21tYW5kSGFuZGxlcnNSZXNvbHZlclBhaXJzVG9PYmplY3Q6IChcbiAgcGFpcnM6IFtlbnRpdHlOYW1lOiBzdHJpbmcsIGVudGl0eUNvbW1hbmRSZXNvbHZlcnM6ICgpID0+IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcn1dW10sXG4pID0+IHtbZW50aXR5TmFtZTogc3RyaW5nXTogKCkgPT4ge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZFJlc29sdmVyfX0gPSBfLnJlZHVjZShcbiAgKGFjYywgZWxlbWVudCkgPT4gKHsuLi5hY2MsIFtlbGVtZW50WzBdXTogZWxlbWVudFsxXX0pLFxuICB7fSxcbik7XG5cbmNvbnN0IGNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnM6IChjb21tYW5kSGFuZGxlcnM6IHtcbiAgW2VudGl0eU5hbWU6IHN0cmluZ106IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRIYW5kbGVyfTtcbn0pID0+IHtbZW50aXR5TmFtZTogc3RyaW5nXTogKCkgPT4ge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZFJlc29sdmVyfX0gPSBfLnBpcGUoXG4gIF8udG9QYWlycyxcbiAgbWFwRW50aXR5Q29tbWFuZEhhbmRsZXJQYWlyc1RvRW50aXR5UmVzb2x2ZXJQYWlycyxcbiAgbWVyZ2VFbnRpdHlDb21tYW5kSGFuZGxlcnNSZXNvbHZlclBhaXJzVG9PYmplY3QsXG4pO1xuXG5leHBvcnQgY29uc3QgY29udmVydEhhbmRsZXJzVG9SZXNvbHZlcnMgPSAoaGFuZGxlcnM6IEhhbmRsZXJQYXJhbXMpOiBIYW5kbGVyUmVzdWx0ID0+ICh7XG4gIFF1ZXJ5OiBjb252ZXJ0UXVlcnlIYW5kbGVycyhoYW5kbGVycy5RdWVyeSksXG4gIE11dGF0aW9uOiBjb252ZXJ0RW50aXR5Q29tbWFuZEhhbmRsZXJzKGhhbmRsZXJzLk11dGF0aW9uKSxcbn0pO1xuIl19