"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.convertHandlersToResolvers = void 0;

var _rxjs = require("rxjs");

var _fp = _interopRequireDefault(require("lodash/fp"));

var _graphqlFields = _interopRequireDefault(require("graphql-fields"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const convertQueryHandlerToResolver = queryHandler => (_parent, args, context, info) => {
  const fields = (0, _graphqlFields.default)(info, {}, {
    processArguments: true
  });
  return (0, _rxjs.lastValueFrom)(queryHandler({ ...args.query,
    fields
  }, context));
};

const mapQueryHandlerPairsToResolverPairs = _fp.default.map(pair => [pair[0], convertQueryHandlerToResolver(pair[1])]);

const mergeQueryResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertQueryHandlers = _fp.default.pipe(_fp.default.toPairs, mapQueryHandlerPairsToResolverPairs, mergeQueryResolverPairsToObject);

const mergeCommandResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertCommandHandlerToResolver = commandHandler => (args, context, info) => {
  const fields = (0, _graphqlFields.default)(info, {}, {
    processArguments: true
  });
  return commandHandler({ ...args.payload,
    fields
  }, context).toPromise();
};

const mapCommandHandlerPairsToResolverPairs = _fp.default.map(pair => [pair[0], convertCommandHandlerToResolver(pair[1])]);

const convertEntityCommandHandlersToEntityResolvers = _fp.default.pipe(_fp.default.toPairs, mapCommandHandlerPairsToResolverPairs, mergeCommandResolverPairsToObject);

const mapEntityCommandHandlerPairsToEntityResolverPairs = _fp.default.map(pair => [pair[0], () => convertEntityCommandHandlersToEntityResolvers(pair[1])]);

const mergeEntityCommandHandlersResolverPairsToObject = _fp.default.reduce((acc, element) => ({ ...acc,
  [element[0]]: element[1]
}), {});

const convertEntityCommandHandlers = _fp.default.pipe(_fp.default.toPairs, mapEntityCommandHandlerPairsToEntityResolverPairs, mergeEntityCommandHandlersResolverPairsToObject);

const convertHandlersToResolvers = handlers => ({
  Query: convertQueryHandlers(handlers.Query),
  Mutation: convertEntityCommandHandlers(handlers.Mutation)
});

exports.convertHandlersToResolvers = convertHandlersToResolvers;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2NvbnZlcnQtaGFuZGxlcnMtdG8tcmVzb2x2ZXJzLnRzIl0sIm5hbWVzIjpbImNvbnZlcnRRdWVyeUhhbmRsZXJUb1Jlc29sdmVyIiwicXVlcnlIYW5kbGVyIiwiX3BhcmVudCIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsImZpZWxkcyIsInByb2Nlc3NBcmd1bWVudHMiLCJxdWVyeSIsIm1hcFF1ZXJ5SGFuZGxlclBhaXJzVG9SZXNvbHZlclBhaXJzIiwiXyIsIm1hcCIsInBhaXIiLCJtZXJnZVF1ZXJ5UmVzb2x2ZXJQYWlyc1RvT2JqZWN0IiwicmVkdWNlIiwiYWNjIiwiZWxlbWVudCIsImNvbnZlcnRRdWVyeUhhbmRsZXJzIiwicGlwZSIsInRvUGFpcnMiLCJtZXJnZUNvbW1hbmRSZXNvbHZlclBhaXJzVG9PYmplY3QiLCJjb252ZXJ0Q29tbWFuZEhhbmRsZXJUb1Jlc29sdmVyIiwiY29tbWFuZEhhbmRsZXIiLCJwYXlsb2FkIiwidG9Qcm9taXNlIiwibWFwQ29tbWFuZEhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlycyIsImNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnNUb0VudGl0eVJlc29sdmVycyIsIm1hcEVudGl0eUNvbW1hbmRIYW5kbGVyUGFpcnNUb0VudGl0eVJlc29sdmVyUGFpcnMiLCJtZXJnZUVudGl0eUNvbW1hbmRIYW5kbGVyc1Jlc29sdmVyUGFpcnNUb09iamVjdCIsImNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnMiLCJjb252ZXJ0SGFuZGxlcnNUb1Jlc29sdmVycyIsImhhbmRsZXJzIiwiUXVlcnkiLCJNdXRhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7O0FBY0EsTUFBTUEsNkJBQTZCLEdBQ1BDLFlBQTFCLElBQ0EsQ0FBQ0MsT0FBRCxFQUFVQyxJQUFWLEVBQWdCQyxPQUFoQixFQUF5QkMsSUFBekIsS0FBa0M7QUFDaEMsUUFBTUMsTUFBTSxHQUFHLDRC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QUFDRSxRQUFRLENBQUNFLFFBQVY7QUFGK0MsQ0FBN0MsQ0FBbkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2xhc3RWYWx1ZUZyb219IGZyb20gJ3J4anMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoL2ZwJztcbmltcG9ydCBncmFwaHFsRmllbGRzIGZyb20gJ2dyYXBocWwtZmllbGRzJztcbmltcG9ydCB0eXBlIHtDb21tYW5kLCBDb21tYW5kSGFuZGxlciwgQ29tbWFuZFJlc29sdmVyLCBRdWVyeSwgUXVlcnlIYW5kbGVyLCBRdWVyeVJlc29sdmVyfSBmcm9tICcuLi9pbnRlcmZhY2VzJztcblxuaW50ZXJmYWNlIEhhbmRsZXJQYXJhbXMge1xuICBRdWVyeToge1tlbnRpdHlOYW1lOiBzdHJpbmddOiBRdWVyeUhhbmRsZXJ9O1xuICBNdXRhdGlvbjoge1tlbnRpdHlOYW1lOiBzdHJpbmddOiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kSGFuZGxlcn19O1xufVxuXG5pbnRlcmZhY2UgSGFuZGxlclJlc3VsdCB7XG4gIFF1ZXJ5OiB7W2VudGl0eU5hbWU6IHN0cmluZ106IFF1ZXJ5UmVzb2x2ZXJ9O1xuICBNdXRhdGlvbjoge1tlbnRpdHlOYW1lOiBzdHJpbmddOiAoKSA9PiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kUmVzb2x2ZXJ9fTtcbiAgW2tleTogc3RyaW5nXTogdW5rbm93bjtcbn1cblxuY29uc3QgY29udmVydFF1ZXJ5SGFuZGxlclRvUmVzb2x2ZXIgPVxuICA8USBleHRlbmRzIFF1ZXJ5ID0gUXVlcnk+KHF1ZXJ5SGFuZGxlcjogUXVlcnlIYW5kbGVyPFE+KTogUXVlcnlSZXNvbHZlcjxRPiA9PlxuICAoX3BhcmVudCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgIGNvbnN0IGZpZWxkcyA9IGdyYXBocWxGaWVsZHMoaW5mbywge30sIHtwcm9jZXNzQXJndW1lbnRzOiB0cnVlfSk7XG4gICAgcmV0dXJuIGxhc3RWYWx1ZUZyb20ocXVlcnlIYW5kbGVyKHsuLi5hcmdzLnF1ZXJ5LCBmaWVsZHN9LCBjb250ZXh0KSk7XG4gIH07XG5cbmNvbnN0IG1hcFF1ZXJ5SGFuZGxlclBhaXJzVG9SZXNvbHZlclBhaXJzOiAobGlzdDogW3N0cmluZywgUXVlcnlIYW5kbGVyXVtdKSA9PiBbc3RyaW5nLCBRdWVyeVJlc29sdmVyXVtdID0gXy5tYXAoXG4gIChwYWlyKSA9PiBbcGFpclswXSwgY29udmVydFF1ZXJ5SGFuZGxlclRvUmVzb2x2ZXIocGFpclsxXSldLFxuKTtcblxuY29uc3QgbWVyZ2VRdWVyeVJlc29sdmVyUGFpcnNUb09iamVjdDogKHBhaXJzOiBbc3RyaW5nLCBRdWVyeVJlc29sdmVyXVtdKSA9PiB7W2VudGl0eU5hbWU6IHN0cmluZ106IFF1ZXJ5UmVzb2x2ZXJ9ID1cbiAgXy5yZWR1Y2UoKGFjYywgZWxlbWVudCkgPT4gKHsuLi5hY2MsIFtlbGVtZW50WzBdXTogZWxlbWVudFsxXX0pLCB7fSk7XG5cbmNvbnN0IGNvbnZlcnRRdWVyeUhhbmRsZXJzOiAocXVlcnlIYW5kbGVyczoge1tlbnRpdHlOYW1lOiBzdHJpbmddOiBRdWVyeUhhbmRsZXJ9KSA9PiB7XG4gIFtlbnRpdHlOYW1lOiBzdHJpbmddOiBRdWVyeVJlc29sdmVyO1xufSA9IF8ucGlwZShfLnRvUGFpcnMsIG1hcFF1ZXJ5SGFuZGxlclBhaXJzVG9SZXNvbHZlclBhaXJzLCBtZXJnZVF1ZXJ5UmVzb2x2ZXJQYWlyc1RvT2JqZWN0KTtcblxuY29uc3QgbWVyZ2VDb21tYW5kUmVzb2x2ZXJQYWlyc1RvT2JqZWN0OiAocGFpcnM6IFtzdHJpbmcsIENvbW1hbmRSZXNvbHZlcl1bXSkgPT4ge1xuICBbZW50aXR5TmFtZTogc3RyaW5nXTogQ29tbWFuZFJlc29sdmVyO1xufSA9IF8ucmVkdWNlKChhY2MsIGVsZW1lbnQpID0+ICh7Li4uYWNjLCBbZWxlbWVudFswXV06IGVsZW1lbnRbMV19KSwge30pO1xuXG5jb25zdCBjb252ZXJ0Q29tbWFuZEhhbmRsZXJUb1Jlc29sdmVyID1cbiAgPEMgZXh0ZW5kcyBDb21tYW5kPihjb21tYW5kSGFuZGxlcjogQ29tbWFuZEhhbmRsZXI8Qz4pOiBDb21tYW5kUmVzb2x2ZXI8Qz4gPT5cbiAgKGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcbiAgICBjb25zdCBmaWVsZHMgPSBncmFwaHFsRmllbGRzKGluZm8sIHt9LCB7cHJvY2Vzc0FyZ3VtZW50czogdHJ1ZX0pO1xuICAgIHJldHVybiBjb21tYW5kSGFuZGxlcih7Li4uYXJncy5wYXlsb2FkLCBmaWVsZHN9LCBjb250ZXh0KS50b1Byb21pc2UoKTtcbiAgfTtcblxuY29uc3QgbWFwQ29tbWFuZEhhbmRsZXJQYWlyc1RvUmVzb2x2ZXJQYWlyczogKGxpc3Q6IFtzdHJpbmcsIENvbW1hbmRIYW5kbGVyXVtdKSA9PiBbc3RyaW5nLCBDb21tYW5kUmVzb2x2ZXJdW10gPSBfLm1hcChcbiAgKHBhaXIpID0+IFtwYWlyWzBdLCBjb252ZXJ0Q29tbWFuZEhhbmRsZXJUb1Jlc29sdmVyKHBhaXJbMV0pXSxcbik7XG5cbmNvbnN0IGNvbnZlcnRFbnRpdHlDb21tYW5kSGFuZGxlcnNUb0VudGl0eVJlc29sdmVyczogKGVudGl0eUNvbW1hbmRIYW5kbGVyczoge1xuICBbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRIYW5kbGVyO1xufSkgPT4ge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZFJlc29sdmVyfSA9IF8ucGlwZShcbiAgXy50b1BhaXJzLFxuICBtYXBDb21tYW5kSGFuZGxlclBhaXJzVG9SZXNvbHZlclBhaXJzLFxuICBtZXJnZUNvbW1hbmRSZXNvbHZlclBhaXJzVG9PYmplY3QsXG4pO1xuXG5jb25zdCBtYXBFbnRpdHlDb21tYW5kSGFuZGxlclBhaXJzVG9FbnRpdHlSZXNvbHZlclBhaXJzOiAoXG4gIGxpc3Q6IFtlbnRpdHlOYW1lOiBzdHJpbmcsIGVudGl0eUNvbW1hbmRIYW5kbGVyczoge1tjb21tYW5kTmFtZTogc3RyaW5nXTogQ29tbWFuZEhhbmRsZXJ9XVtdLFxuKSA9PiBbZW50aXR5TmFtZTogc3RyaW5nLCBlbnRpdHlDb21tYW5kUmVzb2x2ZXJzOiAoKSA9PiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kUmVzb2x2ZXJ9XVtdID0gXy5tYXAoKHBhaXIpID0+IFtcbiAgcGFpclswXSxcbiAgKCkgPT4gY29udmVydEVudGl0eUNvbW1hbmRIYW5kbGVyc1RvRW50aXR5UmVzb2x2ZXJzKHBhaXJbMV0pLFxuXSk7XG5cbmNvbnN0IG1lcmdlRW50aXR5Q29tbWFuZEhhbmRsZXJzUmVzb2x2ZXJQYWlyc1RvT2JqZWN0OiAoXG4gIHBhaXJzOiBbZW50aXR5TmFtZTogc3RyaW5nLCBlbnRpdHlDb21tYW5kUmVzb2x2ZXJzOiAoKSA9PiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kUmVzb2x2ZXJ9XVtdLFxuKSA9PiB7W2VudGl0eU5hbWU6IHN0cmluZ106ICgpID0+IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcn19ID0gXy5yZWR1Y2UoXG4gIChhY2MsIGVsZW1lbnQpID0+ICh7Li4uYWNjLCBbZWxlbWVudFswXV06IGVsZW1lbnRbMV19KSxcbiAge30sXG4pO1xuXG5jb25zdCBjb252ZXJ0RW50aXR5Q29tbWFuZEhhbmRsZXJzOiAoY29tbWFuZEhhbmRsZXJzOiB7XG4gIFtlbnRpdHlOYW1lOiBzdHJpbmddOiB7W2NvbW1hbmROYW1lOiBzdHJpbmddOiBDb21tYW5kSGFuZGxlcn07XG59KSA9PiB7W2VudGl0eU5hbWU6IHN0cmluZ106ICgpID0+IHtbY29tbWFuZE5hbWU6IHN0cmluZ106IENvbW1hbmRSZXNvbHZlcn19ID0gXy5waXBlKFxuICBfLnRvUGFpcnMsXG4gIG1hcEVudGl0eUNvbW1hbmRIYW5kbGVyUGFpcnNUb0VudGl0eVJlc29sdmVyUGFpcnMsXG4gIG1lcmdlRW50aXR5Q29tbWFuZEhhbmRsZXJzUmVzb2x2ZXJQYWlyc1RvT2JqZWN0LFxuKTtcblxuZXhwb3J0IGNvbnN0IGNvbnZlcnRIYW5kbGVyc1RvUmVzb2x2ZXJzID0gKGhhbmRsZXJzOiBIYW5kbGVyUGFyYW1zKTogSGFuZGxlclJlc3VsdCA9PiAoe1xuICBRdWVyeTogY29udmVydFF1ZXJ5SGFuZGxlcnMoaGFuZGxlcnMuUXVlcnkpLFxuICBNdXRhdGlvbjogY29udmVydEVudGl0eUNvbW1hbmRIYW5kbGVycyhoYW5kbGVycy5NdXRhdGlvbiksXG59KTtcbiJdfQ==