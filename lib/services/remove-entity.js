"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.removeEntity = void 0;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _helpers = require("../helpers");

const removeEntity = ({
  id,
  repository,
  validatePermission,
  fields
}) => repository.getById({
  id,
  fields: fields || ['id', 'createdBy']
}).pipe((0, _operators.map)(_helpers.validateEntityExist), (0, _operators.switchMap)(entity => validatePermission ? validatePermission(entity) : (0, _rxjs.of)(entity)), (0, _operators.map)(() => id), (0, _operators.switchMap)(repository.remove));

exports.removeEntity = removeEntity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9yZW1vdmUtZW50aXR5LnRzIl0sIm5hbWVzIjpbInJlbW92ZUVudGl0eSIsImlkIiwicmVwb3NpdG9yeSIsInZhbGlkYXRlUGVybWlzc2lvbiIsImZpZWxkcyIsImdldEJ5SWQiLCJwaXBlIiwidmFsaWRhdGVFbnRpdHlFeGlzdCIsImVudGl0eSIsInJlbW92ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUVPLE1BQU1BLFlBS1MsR0FBRyxDQUFDO0FBQUNDLEVBQUFBLEVBQUQ7QUFBS0MsRUFBQUEsVUFBTDtBQUFpQkMsRUFBQUEsa0JBQWpCO0FBQXFDQyxFQUFBQTtBQUFyQyxDQUFELEtBQ3ZCRixVQUFVLENBQUNHLE9BQVgsQ0FBbUI7QUFBQ0osRUFBQUEsRUFBRDtBQUFLRyxFQUFBQSxNQUFNLEVBQUVBLE1BQU0sSUFBSSxDQUFDLElBQUQsRUFBTyxXQUFQO0FBQXZCLENBQW5CLEVBQWdFRSxJQUFoRSxDQUNFLG9CQUFJQyw0QkFBSixDQURGLEVBRUUsMEJBQVdDLE1BQUQsSUFBYUwsa0JBQWtCLEdBQUdBLGtCQUFrQixDQUFDSyxNQUFELENBQXJCLEdBQWdDLGNBQUdBLE1BQUgsQ0FBekUsQ0FGRixFQUdFLG9CQUFJLE1BQU1QLEVBQVYsQ0FIRixFQUlFLDBCQUFVQyxVQUFVLENBQUNPLE1BQXJCLENBSkYsQ0FOSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcbmltcG9ydCB0eXBlIHtFbnRpdHksIFdyaXRlUmVwb3NpdG9yeX0gZnJvbSAnQGxpYi9pbnRlcmZhY2VzJztcblxuaW1wb3J0IHtvZn0gZnJvbSAncnhqcyc7XG5pbXBvcnQge21hcCwgc3dpdGNoTWFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge3ZhbGlkYXRlRW50aXR5RXhpc3R9IGZyb20gJ0BsaWIvaGVscGVycyc7XG5cbmV4cG9ydCBjb25zdCByZW1vdmVFbnRpdHk6IDxJZCA9IHN0cmluZywgRSBleHRlbmRzIEVudGl0eTxJZD4gPSBFbnRpdHk8SWQ+PihwYXJhbXM6IHtcbiAgaWQ6IElkO1xuICByZXBvc2l0b3J5OiBXcml0ZVJlcG9zaXRvcnk8SWQsIEU+O1xuICB2YWxpZGF0ZVBlcm1pc3Npb24/OiAoZW50aXR5OiB7aWQ6IElkfSAmIFBhcnRpYWw8RT4pID0+IE9ic2VydmFibGU8e2lkOiBJZH0gJiBQYXJ0aWFsPEU+PjtcbiAgZmllbGRzPzogc3RyaW5nW107XG59KSA9PiBPYnNlcnZhYmxlPHZvaWQ+ID0gKHtpZCwgcmVwb3NpdG9yeSwgdmFsaWRhdGVQZXJtaXNzaW9uLCBmaWVsZHN9KSA9PlxuICByZXBvc2l0b3J5LmdldEJ5SWQoe2lkLCBmaWVsZHM6IGZpZWxkcyB8fCBbJ2lkJywgJ2NyZWF0ZWRCeSddfSkucGlwZShcbiAgICBtYXAodmFsaWRhdGVFbnRpdHlFeGlzdCksXG4gICAgc3dpdGNoTWFwKChlbnRpdHkpID0+ICh2YWxpZGF0ZVBlcm1pc3Npb24gPyB2YWxpZGF0ZVBlcm1pc3Npb24oZW50aXR5KSA6IG9mKGVudGl0eSkpKSxcbiAgICBtYXAoKCkgPT4gaWQpLFxuICAgIHN3aXRjaE1hcChyZXBvc2l0b3J5LnJlbW92ZSksXG4gICk7XG4iXX0=