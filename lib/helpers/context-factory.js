"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.contextFactory = void 0;

const contextFactory = ({
  firebaseApp
}) => ({
  req
}) => firebaseApp.auth().verifyIdToken(req.headers.authorization || '').then(decodedIdToken => decodedIdToken.id ? {
  user: {
    id: decodedIdToken.id,
    roles: decodedIdToken.roles,
    permissions: decodedIdToken.permissions
  }
} : {
  user: undefined
}).catch(() => ({
  user: undefined
}));

exports.contextFactory = contextFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2NvbnRleHQtZmFjdG9yeS50cyJdLCJuYW1lcyI6WyJjb250ZXh0RmFjdG9yeSIsImZpcmViYXNlQXBwIiwicmVxIiwiYXV0aCIsInZlcmlmeUlkVG9rZW4iLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInRoZW4iLCJkZWNvZGVkSWRUb2tlbiIsImlkIiwidXNlciIsInJvbGVzIiwicGVybWlzc2lvbnMiLCJ1bmRlZmluZWQiLCJjYXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUtPLE1BQU1BLGNBQW9HLEdBQUcsQ0FBQztBQUNuSEMsRUFBQUE7QUFEbUgsQ0FBRCxLQUU5RyxDQUFDO0FBQUNDLEVBQUFBO0FBQUQsQ0FBRCxLQUNKRCxXQUFXLENBQ1JFLElBREgsR0FFR0MsYUFGSCxDQUVpQkYsR0FBRyxDQUFDRyxPQUFKLENBQVlDLGFBQVosSUFBNkIsRUFGOUMsRUFHR0MsSUFISCxDQUdTQyxjQUFELElBQ0pBLGNBQWMsQ0FBQ0MsRUFBZixHQUNJO0FBQ0VDLEVBQUFBLElBQUksRUFBRTtBQUNKRCxJQUFBQSxFQUFFLEVBQUVELGNBQWMsQ0FBQ0MsRUFEZjtBQUVKRSxJQUFBQSxLQUFLLEVBQUVILGNBQWMsQ0FBQ0csS0FGbEI7QUFHSkMsSUFBQUEsV0FBVyxFQUFFSixjQUFjLENBQUNJO0FBSHhCO0FBRFIsQ0FESixHQVFJO0FBQUNGLEVBQUFBLElBQUksRUFBRUc7QUFBUCxDQVpSLEVBY0dDLEtBZEgsQ0FjUyxPQUFPO0FBQUNKLEVBQUFBLElBQUksRUFBRUc7QUFBUCxDQUFQLENBZFQsQ0FISyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtBcG9sbG9TZXJ2ZXJFeHByZXNzQ29uZmlnfSBmcm9tICdhcG9sbG8tc2VydmVyLWV4cHJlc3MnO1xuaW1wb3J0IHR5cGUge0F1dGhVc2VyfSBmcm9tICdAbGliL2ludGVyZmFjZXMnO1xuXG5pbXBvcnQgKiBhcyBmaXJlYmFzZUFkbWluIGZyb20gJ2ZpcmViYXNlLWFkbWluJztcblxuZXhwb3J0IGNvbnN0IGNvbnRleHRGYWN0b3J5OiAoZGVwczoge2ZpcmViYXNlQXBwOiBmaXJlYmFzZUFkbWluLmFwcC5BcHB9KSA9PiBBcG9sbG9TZXJ2ZXJFeHByZXNzQ29uZmlnWydjb250ZXh0J10gPSAoe1xuICBmaXJlYmFzZUFwcCxcbn0pID0+ICh7cmVxfSk6IFByb21pc2U8e3VzZXI6IEF1dGhVc2VyfT4gPT5cbiAgZmlyZWJhc2VBcHBcbiAgICAuYXV0aCgpXG4gICAgLnZlcmlmeUlkVG9rZW4ocmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiB8fCAnJylcbiAgICAudGhlbigoZGVjb2RlZElkVG9rZW4pID0+XG4gICAgICBkZWNvZGVkSWRUb2tlbi5pZFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgaWQ6IGRlY29kZWRJZFRva2VuLmlkLFxuICAgICAgICAgICAgICByb2xlczogZGVjb2RlZElkVG9rZW4ucm9sZXMsXG4gICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBkZWNvZGVkSWRUb2tlbi5wZXJtaXNzaW9ucyxcbiAgICAgICAgICAgIH0gYXMgQXV0aFVzZXIsXG4gICAgICAgICAgfVxuICAgICAgICA6IHt1c2VyOiB1bmRlZmluZWR9LFxuICAgIClcbiAgICAuY2F0Y2goKCkgPT4gKHt1c2VyOiB1bmRlZmluZWR9KSk7XG4iXX0=